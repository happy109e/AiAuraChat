<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<title>Ai Aura</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<style>
html, body { height: 100%; }
.typing::after { content: "â–"; animation: blink 1s infinite; }
@keyframes blink { 50% { opacity: 0; } }
</style>
</head>

<body class="min-h-screen bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100">

<!-- LOADER -->
<div id="loading" class="fixed inset-0 flex items-center justify-center bg-white dark:bg-gray-900 z-50">
  <div class="text-xl animate-pulse font-semibold">Loading Ai Auraâ€¦</div>
</div>

<!-- APP -->
<div id="app" class="hidden min-h-screen flex">

<!-- SIDEBAR -->
<aside id="sidebar"
  class="fixed md:static inset-y-0 left-0 w-72 bg-gray-100 dark:bg-gray-800 border-r dark:border-gray-700
  transform -translate-x-full md:translate-x-0 transition z-40 flex flex-col">

  <div class="p-4 flex justify-between items-center">
    <h2 class="font-bold">ğŸ’¬ Chats</h2>
    <button onclick="newChat()" class="text-sm px-2 py-1 bg-blue-600 text-white rounded">New</button>
  </div>

  <div id="chatList" class="flex-1 overflow-y-auto px-2 space-y-1"></div>

  <div class="p-3 border-t dark:border-gray-700">
    <button onclick="openSettings()" class="w-full py-2 bg-gray-200 dark:bg-gray-700 rounded">
      âš™ Settings
    </button>
  </div>
</aside>

<!-- MAIN -->
<main class="flex-1 flex flex-col min-h-screen md:ml-72">

<!-- HEADER -->
<header class="flex justify-between items-center p-4 border-b dark:border-gray-700">
  <div class="flex items-center gap-3">
    <button onclick="toggleSidebar()" class="md:hidden">â˜°</button>
    <h1 class="text-xl font-bold">âœ¨ Ai Aura</h1>
  </div>
  <button onclick="toggleDarkMode()">ğŸŒ™</button>
</header>

<!-- CHAT AREA -->
<section id="messages" class="flex-1 overflow-y-auto p-4 space-y-4 relative">

  <!-- EMPTY PLACEHOLDER -->
  <div id="emptyState"
    class="absolute inset-0 flex flex-col items-center justify-center text-center pointer-events-none">
    <h2 class="text-3xl font-bold opacity-80">Ai Aura Chat</h2>
    <p class="mt-2 opacity-60">Ask anythingâ€¦</p>
  </div>

</section>

<!-- INPUT -->
<footer class="sticky bottom-0 bg-white dark:bg-gray-900 border-t dark:border-gray-700 p-3">
  <div class="flex gap-2 items-end">

    <input type="file" id="imageInput" accept="image/*" class="hidden">

    <button onclick="imageInput.click()" class="px-3 py-2 bg-gray-200 dark:bg-gray-700 rounded">
      ğŸ–¼
    </button>

    <textarea id="userInput" rows="1"
      class="flex-1 resize-none p-2 rounded border dark:border-gray-600 bg-transparent focus:outline-none"
      placeholder="Message Ai Auraâ€¦"></textarea>

    <button onclick="sendMessage()" class="px-4 py-2 bg-blue-600 text-white rounded">
      Send
    </button>
  </div>
</footer>

</main>
</div>

<!-- SETTINGS -->
<div id="settingsModal" class="fixed inset-0 bg-black/40 hidden items-center justify-center z-50">
<div class="bg-white dark:bg-gray-800 p-4 rounded w-full max-w-md space-y-4">

<h3 class="font-bold text-lg">âš™ Ai Aura Settings</h3>

<div>
<label class="text-sm">OpenRouter API Key</label>
<div class="flex gap-2">
<input id="apiKeyInput" type="password" class="flex-1 p-2 rounded border dark:border-gray-600 bg-transparent">
<button onclick="toggleApiHistory()" class="px-2 bg-gray-200 dark:bg-gray-700 rounded">â¬‡ï¸</button>
</div>
<div id="apiHistory" class="hidden mt-2 border rounded dark:border-gray-600"></div>
</div>

<div>
<label class="text-sm">Model</label>
<input id="modelInput" class="w-full p-2 rounded border dark:border-gray-600 bg-transparent"
value="deepseek/deepseek-r1:free">
</div>

<div>
<label class="text-sm">System Prompt</label>
<textarea id="systemPromptInput" rows="3"
class="w-full p-2 rounded border dark:border-gray-600 bg-transparent"></textarea>
</div>

<div class="flex justify-end gap-2">
<button onclick="closeSettings()" class="px-4 py-2 bg-gray-300 dark:bg-gray-600 rounded">Cancel</button>
<button onclick="saveSettings()" class="px-4 py-2 bg-blue-600 text-white rounded">Save</button>
</div>

</div>
</div>

<script>
const state={
chats:JSON.parse(localStorage.getItem("ai_aura_chats")||"[]"),
current:null,
api:localStorage.getItem("ai_aura_api")||"",
model:localStorage.getItem("ai_aura_model")||"deepseek/deepseek-r1:free",
system:localStorage.getItem("ai_aura_system")||"",
dark:localStorage.getItem("ai_aura_dark")==="true"
};

function init(){
loading.style.display="none";
app.classList.remove("hidden");
if(state.dark)document.documentElement.classList.add("dark");
if(!state.chats.length)newChat();else loadChat(state.chats[0].id);
renderChatList();
}
window.onload=init;

function toggleSidebar(){sidebar.classList.toggle("-translate-x-full");}
function toggleDarkMode(){
state.dark=!state.dark;
localStorage.setItem("ai_aura_dark",state.dark);
document.documentElement.classList.toggle("dark");
}

function newChat(){
const c={id:Date.now(),name:"New Chat",messages:[]};
state.chats.unshift(c);save();loadChat(c.id);
}

function loadChat(id){
state.current=state.chats.find(c=>c.id===id);
renderMessages();renderChatList();
}

function renderChatList(){
chatList.innerHTML="";
state.chats.forEach(c=>{
const b=document.createElement("button");
b.textContent=c.name;
b.className="w-full text-left px-2 py-1 rounded hover:bg-gray-200 dark:hover:bg-gray-700";
b.onclick=()=>loadChat(c.id);
chatList.appendChild(b);
});
}

function renderMessages(){
messages.innerHTML="";
if(!state.current.messages.length){
emptyState.style.display="flex";
}else emptyState.style.display="none";

state.current.messages.forEach(m=>{
const d=document.createElement("div");
d.className=m.role==="user"?"text-right":"text-left";
d.innerHTML=`<div class="inline-block max-w-[85%] p-3 rounded
${m.role==="user"?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700"}">
${marked.parse(m.content)}</div>`;
messages.appendChild(d);
});
messages.scrollTop=messages.scrollHeight;
}

async function sendMessage(){
const text=userInput.value.trim();
if(!text)return;
state.current.messages.push({role:"user",content:text});
userInput.value="";
renderMessages();

const ai={role:"assistant",content:""};
state.current.messages.push(ai);
renderMessages();

await stream(ai);
save();
}

async function stream(ai){
if(!state.api){
ai.content="âš  Add API key in settings.";
renderMessages();return;
}
const res=await fetch("https://openrouter.ai/api/v1/chat/completions",{
method:"POST",
headers:{Authorization:"Bearer "+state.api,"Content-Type":"application/json"},
body:JSON.stringify({
model:state.model,stream:true,
messages:[
...(state.system?[{role:"system",content:state.system}]:[]),
...state.current.messages
]
})
});
const r=res.body.getReader();const d=new TextDecoder();
while(true){
const {done,value}=await r.read();
if(done)break;
d.decode(value).split("\n").forEach(l=>{
if(l.startsWith("data: ")){
const j=l.replace("data: ","");
if(j==="[DONE]")return;
try{ai.content+=JSON.parse(j).choices[0].delta.content||"";renderMessages();}catch{}
}
});
}
}

function save(){localStorage.setItem("ai_aura_chats",JSON.stringify(state.chats));}

function openSettings(){apiKeyInput.value=state.api;modelInput.value=state.model;systemPromptInput.value=state.system;settingsModal.classList.remove("hidden");settingsModal.classList.add("flex");}
function closeSettings(){settingsModal.classList.add("hidden");}
function saveSettings(){
state.api=apiKeyInput.value.trim();
state.model=modelInput.value.trim();
state.system=systemPromptInput.value;
localStorage.setItem("ai_aura_api",state.api);
localStorage.setItem("ai_aura_model",state.model);
localStorage.setItem("ai_aura_system",state.system);
saveApi(state.api);
closeSettings();
}

const API_H="ai_aura_api_history";
function getApis(){return JSON.parse(localStorage.getItem(API_H)||"[]");}
function saveApi(k){if(!k)return;let h=getApis();if(!h.includes(k)){h.unshift(k);localStorage.setItem(API_H,JSON.stringify(h.slice(0,10)));}}
function toggleApiHistory(){apiHistory.classList.toggle("hidden");renderApiHistory();}
function renderApiHistory(){
apiHistory.innerHTML="";
getApis().forEach(k=>{
const m=k.slice(0,6)+"â€¢â€¢â€¢â€¢"+k.slice(-4);
const r=document.createElement("div");
r.className="flex justify-between px-2 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer";
r.innerHTML=`<span>${m}</span><button>ğŸ—‘ï¸</button>`;
r.querySelector("span").onclick=()=>{apiKeyInput.value=k;apiHistory.classList.add("hidden");};
r.querySelector("button").onclick=e=>{e.stopPropagation();localStorage.setItem(API_H,JSON.stringify(getApis().filter(x=>x!==k)));renderApiHistory();};
apiHistory.appendChild(r);
});
}
</script>

</body>
      </html>
